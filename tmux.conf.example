# ============================================================================
# DELIGHTFUL MULTILEVEL TMUX - EXAMPLE CONFIGURATION
# ============================================================================
#
# This is a reference tmux configuration showing how to integrate the
# 9-level navigation system with a basic tmux setup.
#
# INSTALLATION:
# 1. Copy the "MULTILEVEL NAVIGATION" section below to your ~/.tmux.conf
# 2. Customize the key bindings if needed (see CUSTOMIZATION.md)  
# 3. Run: tmux source-file ~/.tmux.conf
#
# ============================================================================

# Basic tmux configuration (customize as needed)
# Primary prefix for active sessions
unbind C-x
set -g prefix C-x
bind C-x send-prefix

# Secondary prefix for inactive/passthrough sessions
unbind C-a
set -g prefix2 C-a
bind C-a send-prefix -2

set -g base-index 1
setw -g mode-keys vi
set -g mouse on
set-option -g default-terminal screen-256color

# ============================================================================
# BEGIN 9-LEVEL NAVIGATION - COPY THIS SECTION TO YOUR ~/.tmux.conf
# ============================================================================
#
# 9-LEVEL WORKFLOW:
#   1. Start sessions with level identity: `tmux-start-level 2 -s project`
#   2. Navigate to target level: Ctrl+X @ (for Level 2)
#   3. When levels match: Normal tmux commands work (create panes, etc.)
#   4. When levels differ: Session in passthrough mode (uses Ctrl+A prefix)
#
# DUAL PREFIX SYSTEM (prevents nested tmux conflicts):
#   Active sessions:     Ctrl+X prefix (normal tmux commands)
#   Inactive sessions:   Ctrl+A prefix (avoids intercepting child commands)
#
# NAVIGATION:
#   From active:    Ctrl+X !@#$%^&*(  → Jump to Levels 1-9
#   From inactive:  Ctrl+A !@#$%^&*(  → Jump to Levels 1-9
#   Sequential:     Ctrl+V (down), Ctrl+B (up) with wrapping
#   Emergency:      Ctrl+X ! or Ctrl+A !  → Always back to Level 1
#   Help:          Run `tmux-level-help` for current level info
#
# STATUS BAR DISPLAY:
#   Active:     [Level:L2 ✓] - Uses Ctrl+X prefix, controls tmux normally
#   Passthrough: [Nav:L2|Session:L1] - Uses Ctrl+A prefix, transparent to child
#
# SOOTHING COLORS:
#   Mint green: Active sessions (harmony)
#   Soft blue:  Passthrough sessions

# Initialize level tracking variables
set -g @active_level 1
set -g @max_levels 9

# Direct level jumps using Ctrl+X Shift+1-9 (!@#$%^&*())
bind ! run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 1'
bind @ run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 2'
bind '#' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 3'
bind '$' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 4'
bind % run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 5'
bind '^' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 6'
bind '&' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 7'
bind '*' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 8'
bind '(' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 9'

# Sequential navigation
bind -T root C-v run-shell "$HOME/.local/bin/tmux-multilevel/tmux-level-down"
bind -T root C-b run-shell "$HOME/.local/bin/tmux-multilevel/tmux-level-up"

# Unbind common tmux keys from default table to ensure passthrough sessions  
# can't access normal tmux functions after Ctrl+X prefix
# This creates isolation: only active sessions get full tmux functionality

# Unbind alphabetic keys that might conflict with normal tmux usage
unbind q; unbind w; unbind e; unbind r; unbind t; unbind y; unbind u; unbind i; unbind o; unbind p
unbind a; unbind s; unbind d; unbind f; unbind g; unbind h; unbind j; unbind k; unbind l
unbind z; unbind x; unbind c; unbind v; unbind b; unbind n; unbind m

# Unbind symbol keys that might conflict  
unbind ','; unbind '.'; unbind '/'; unbind ';'; unbind '"'; unbind "'"
unbind '{'; unbind '['; unbind '}'; unbind ']'; unbind '|'; unbind '\'
unbind '+'; unbind '='; unbind '_'; unbind '-'; unbind '~'; unbind '`'
unbind '<'; unbind '>'; unbind '?'; unbind ':'

# Off table for passthrough mode (used by session-specific active/passthrough system)
# When sessions are inactive, they use this table for sequential navigation only
# Level jumps require Ctrl+A prefix to avoid conflicts with active sessions
bind -T off C-v run-shell "$HOME/.local/bin/tmux-multilevel/tmux-level-down"
bind -T off C-b run-shell "$HOME/.local/bin/tmux-multilevel/tmux-level-up"

# Level jumps from off table work with Ctrl+A prefix (inactive session prefix)
# This prevents conflicts when active child sessions use Ctrl+X
bind -T off C-a switch-client -T prefix

# Prevent bare symbol navigation in passthrough mode
# Empty bindings block the fallback mechanism - passthrough sessions can't use bare symbols
bind -T off ! 
bind -T off @
bind -T off '#'
bind -T off '$'
bind -T off %
bind -T off '^'
bind -T off '&'
bind -T off '*' 
bind -T off '('

# Session persistence for active level state
set-hook -g session-created 'run-shell "
if [ -f ~/.tmux_level_state ]; then
    level=$(cat ~/.tmux_level_state 2>/dev/null || echo 1)
    ~/.local/bin/tmux-multilevel/tmux-goto-level $level 2>/dev/null || ~/.local/bin/tmux-multilevel/tmux-level-reset
fi"'

# Status Bar with multilevel indicator
set-option -g status-interval 1
set-option -g status-left ''
# Multi-level navigation status: Shows [L3:X ●●●○○○○○○] format with color coding
# Available formats: --compact, --full, --minimal, --visual
# For help: run `tmux-level-help` or `tmux-level-status --help`
set-option -g status-right "#(~/.local/bin/tmux-multilevel/tmux-level-status --visual) #{?client_prefix,[ACTIVE],} | %l:%M%p"

# ============================================================================
# END MULTILEVEL NAVIGATION
# ============================================================================

# Resume your existing tmux configuration below this line...

# Basic key bindings (customize as needed)
bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}" 
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

bind-key x copy-mode
bind-key p paste-buffer

# Status Bar styling (customize colors as needed)
set-window-option -g window-status-current-style fg=magenta
set-option -g status-style fg=default,bg=black
set-option -g pane-active-border-style fg=colour215,bold
set-option -g pane-border-style fg=colour238