#!/bin/bash
# tmux-add-level-bindings - Add all necessary bindings to a specific key-table
# Usage: tmux-add-level-bindings <level_number>

set -euo pipefail

if [[ $# -ne 1 ]]; then
    echo "Usage: tmux-add-level-bindings <level_number>"
    exit 1
fi

level=$1
table="level${level}"

# Add sequential navigation
tmux bind -T "$table" C-v run-shell '~/.local/bin/tmux-multilevel/tmux-level-down' 2>/dev/null || true
tmux bind -T "$table" C-b run-shell '~/.local/bin/tmux-multilevel/tmux-level-up' 2>/dev/null || true

# All levels use Ctrl+X prefix consistently  
# Note: C-x C-x NOT bound here to preserve copy-mode functionality
tmux bind -T "$table" C-x send-prefix 2>/dev/null || true

# Add direct jumps (critical for escaping!)
tmux bind -T "$table" ! run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 1' 2>/dev/null || true
tmux bind -T "$table" @ run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 2' 2>/dev/null || true
tmux bind -T "$table" '#' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 3' 2>/dev/null || true
tmux bind -T "$table" '$' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 4' 2>/dev/null || true
tmux bind -T "$table" % run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 5' 2>/dev/null || true
tmux bind -T "$table" '^' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 6' 2>/dev/null || true
tmux bind -T "$table" '&' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 7' 2>/dev/null || true
tmux bind -T "$table" '*' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 8' 2>/dev/null || true
tmux bind -T "$table" '(' run-shell '~/.local/bin/tmux-multilevel/tmux-goto-level 9' 2>/dev/null || true

echo "Added bindings to $table"